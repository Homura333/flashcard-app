# 英語フレーズ暗記カードアプリ - 開発者用テストドキュメント

## 1. 対象読者

* 開発者本人（将来の参照用）
* ChatGPTや他AIへの引き継ぎ用（プロジェクト理解の補助）

## 2. テスト方針

* 主要機能の動作確認を中心に実施
* 高いコードカバレッジは目標とせず、機能的に必要十分な範囲でテスト
* 自動化テストは `@testing-library/react` を使用
* カバレッジが低くても、主要機能が動作することを優先

## 3. 主要テスト対象コンポーネント

| コンポーネント / ファイル                 | 主なテスト内容                                           | カバレッジ備考                                          |
| ------------------------------ | ------------------------------------------------- | ------------------------------------------------ |
| `App.tsx`                      | アプリ全体レンダリング、主要画面切替（Menu / Cards / PromptView）     | カバレッジ46%。UIフロー中心で一部未カバー箇所あり                      |
| `PromptView.tsx`               | テキスト入力、自動分割、BLOCKマーカー表示、ドラッグ＆ドロップ、プロンプト保存、メニューに戻る | 機能的には十分テスト済。カバレッジ50%。未カバー箇所は特殊ケース（文末句点なし、ブラウザ依存） |
| `PromptBlock.tsx`              | 抽出プロンプトカード表示                                      | 完全カバレッジ                                          |
| `CardsView.tsx`                | カード一覧表示、ページ移動、カード生成                               | 条件分岐の一部未テスト（カバレッジ58%）                            |
| `CardSingle.tsx`               | カード個別表示・フリップ・前後移動                                 | カバレッジほぼ100%                                      |
| `CardList.tsx`                 | カードリスト表示、ソート・フィルタ                                 | カバレッジ93%                                         |
| `DeckManager.tsx`              | デッキ作成・削除・編集                                       | カバレッジ100%（一部分岐未テスト）                              |
| `MenuView.tsx`                 | メニュー操作・画面切替                                       | 完全カバレッジ                                          |
| `savePrompts.ts`               | プロンプト JSON 保存処理                                   | 完全カバレッジ                                          |
| `useLocalStorage.ts`           | カスタムフック、データ保持                                     | カバレッジ81%                                         |
| `cardReducer.ts`               | Redux風ステート管理                                      | カバレッジ94%                                         |
| `cardUtils.ts`                 | ユーティリティ関数（カード操作）                                  | カバレッジ100%（一部分岐未テスト）                              |
| `DevPanel.tsx` / `TestData.ts` | テスト用補助コンポーネント・データ                                 | 完全カバレッジ                                          |

> 注: カバレッジが低い箇所は UI の複雑な条件分岐や手動操作でしか発生しない部分。主要機能テストに影響はなし。

## 4. テストの種類と内容

### 4.1 `PromptView` コンポーネント

* テキスト入力と自動分割ボタンの動作
* BLOCKマーカー生成確認
* プロンプト保存ボタンで `savePromptsToFile` 呼び出し確認
* メニューに戻るボタンで `setView` 呼び出し確認
* 空テキスト・空白テキストの場合の生成プロンプト未表示確認
* ドラッグ&ドロップ操作で markers 更新確認
* **追加テスト候補**

  * `sliceSentencesWithOffsets` の端数処理（最後の文章が句点なしの場合）
  * `splitBySentenceAndWordCount` の minWords/maxWords 境界値
  * `sanitizeMarkers` の重複・境界値処理
  * `caretRangeFromPointSafe` が異なるブラウザ環境で null 安全に動作するか
  * BLOCK を最初・最後に移動した場合

### 4.2 `CardSingle` コンポーネント

* カード表示・フリップ・前後移動

### 4.3 `CardsView` コンポーネント

* カード一覧表示・ページ切替・カード生成
* 条件分岐の一部未テスト（例: カードが空の場合など）

### 4.4 `DeckManager` コンポーネント

* デッキ作成・削除・編集操作

### 4.5 `MenuView` コンポーネント

* メニュー操作・画面切替

### 4.6 ユーティリティ / フック / ストア

* `savePrompts.ts`: JSON保存処理
* `useLocalStorage.ts`: カスタムフックのデータ保持
* `cardReducer.ts`: ステート変更処理
* `cardUtils.ts`: カード操作のユーティリティ関数

## 5. 注意事項 / 引き継ぎポイント

* カバレッジが低くても主要機能が動作することを確認済み
* 将来の開発者や AI への引き継ぎ時に、未カバー分岐の存在を明記
* UI の特殊ケース（ドラッグ＆ドロップ、空テキスト、ページ切替など）を確認しておくと安心
* 新機能追加時は、主要機能テストの追加のみで十分
* `PromptView` の BLOCK 分割ロジックや JSON プロンプト生成は変更時注意
* ドラッグ&ドロップ処理は DOM API 依存のため、テスト環境でモック必要

## 6. テスト実行コマンド

```
npm test
```

* すべての自動テストを実行
* カバレッジ確認は:

```
npm test -- --coverage
```

